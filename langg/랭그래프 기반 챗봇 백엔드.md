# 랭그래프 기반 챗봇 백엔드

## 프로젝트 개요
사용자와 5회씩 번갈아가며 대화한 후, 대화 내용을 요약하고 적절한 명언을 추천해주는 랭그래프 기반 챗봇 백엔드입니다.

## 주요 기능
- **멀티턴 대화**: 사용자 5회, 챗봇 5회 번갈아가며 대화
- **대화 요약**: 5회 대화 완료 후 자동으로 대화 내용 요약
- **명언 추천**: 대화 요약을 바탕으로 사용자에게 적절한 명언 추천
- **세션 관리**: Flask 세션을 통한 대화 상태 관리

## 기술 스택
- **Backend**: Flask
- **AI Framework**: LangGraph
- **LLM**: OpenAI GPT-4.1-mini
- **Session Management**: Flask Session

## 설치 및 실행

### 1. 가상환경 활성화
```bash
cd chatbot-app
source venv/bin/activate
```

### 2. 서버 실행
```bash
python src/main.py
```

서버가 http://localhost:5000 에서 실행됩니다.

## API 엔드포인트

### 1. 대화 시작
```http
POST /api/chat/start
Content-Type: application/json
```

**응답 예시:**
```json
{
  "success": true,
  "session_id": "uuid-string",
  "message": "대화를 시작합니다. 안녕하세요!"
}
```

### 2. 메시지 전송
```http
POST /api/chat/message
Content-Type: application/json

{
  "message": "사용자 메시지"
}
```

**응답 예시 (대화 중):**
```json
{
  "success": true,
  "bot_response": "챗봇 응답",
  "user_turns": 3,
  "bot_turns": 3,
  "conversation_complete": false
}
```

**응답 예시 (대화 완료):**
```json
{
  "success": true,
  "bot_response": "챗봇 응답",
  "user_turns": 5,
  "bot_turns": 5,
  "conversation_complete": true,
  "summary": "대화 요약 내용",
  "recommended_quote": "추천 명언과 설명"
}
```

### 3. 대화 상태 확인
```http
GET /api/chat/status
```

### 4. 대화 기록 조회
```http
GET /api/chat/history
```

## 테스트 방법

### 1. 수동 테스트 (curl)
```bash
# 대화 시작
curl -X POST http://localhost:5000/api/chat/start -H "Content-Type: application/json" -c cookies.txt

# 메시지 전송
curl -X POST http://localhost:5000/api/chat/message -H "Content-Type: application/json" -b cookies.txt -d '{"message": "안녕하세요!"}'
```

### 2. 자동 테스트 스크립트
```bash
python test_full_conversation.py
```

## 프로젝트 구조
```
chatbot-app/
├── src/
│   ├── chatbot.py              # 랭그래프 워크플로우 구현
│   ├── routes/
│   │   └── chatbot_routes.py   # Flask API 라우트
│   ├── main.py                 # Flask 앱 메인 파일
│   └── ...
├── test_full_conversation.py   # 테스트 스크립트
├── todo.md                     # 개발 진행 상황
└── README.md                   # 이 파일
```

## 주요 특징

### 랭그래프 워크플로우
- **상태 관리**: ConversationState를 통한 대화 상태 추적
- **조건부 분기**: 5회 대화 완료 시 자동으로 요약 및 명언 추천 단계로 이동
- **멀티 노드**: chat_response → check_completion → summarize_conversation → recommend_quote

### 세션 관리
- Flask 세션을 통한 대화 상태 유지
- 각 사용자별 독립적인 대화 세션
- 대화 완료 후 재시작 방지

### 에러 처리
- API 호출 실패 시 적절한 에러 메시지 반환
- 세션 없음, 빈 메시지 등 예외 상황 처리

## 환경 변수
- `OPENAI_API_KEY`: OpenAI API 키 (이미 설정됨)
- `OPENAI_API_BASE`: OpenAI API 베이스 URL (이미 설정됨)

## 주의사항
- 프론트엔드는 별도로 구현해야 합니다
- 현재는 개발 서버로 실행되므로 프로덕션 환경에서는 WSGI 서버 사용 권장
- 세션 데이터는 서버 재시작 시 초기화됩니다

